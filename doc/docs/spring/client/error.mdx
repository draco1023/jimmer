---
sidebar_position: 2 
title: Generate Client Errors
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import { ViewMore } from '@site/src/components/ViewMore';
import {VsModule, VsApi, VsFamily, VsCode, VsField} from '@site/src/components/Image';

This part is actually unrelated to ORM. 

However, since [generate client api](./api) is provided, this part of the functionality must also be provided to make it a complete solution.

## Exception Families

We need to define special Java/Kotlin business exceptions that can be directly translated into data that the client can understand.

How do we define this special type of business exception? There are two extreme choices:

-   Share one business exception class across the entire application, with built-in error codes that the client can understand

-   Define a business exception class for each business error

Obviously, both of the above solutions are unsuitable. The first option is too coarse-grained, with globally maintained error codes that are difficult to maintain. The second option is too fine-grained, requiring the definition of too many exception classes. 

So, Jimmer chooses a compromise: dividing business exceptions into multiple families, with each family using one set of Error Codes.

Jimmer uses enums to define exception families, where the enum also serves as the error code for that family, e.g.

### Define Exception Families

<Tabs groupId="language">
<TabItem value="java" label="Java">

```java title="UserInfoErrorCode.java"  
package com.example.business.error;

import org.babyfish.jimmer.error.ErrorFamily;

// highlight-next-line
@ErrorFamily
public enum UserInfoErrorCode {
    ILLEGAL_USER_NAME,
    PASSWORD_TOO_SHORT,
    PASSWORDS_NOT_SAME
}
```

</TabItem>
<TabItem value="kotlin" label="Kotlin">

```kotlin title="UserInfoErrorCode.kt"
package com.example.business.error

import org.babyfish.jimmer.error.ErrorFamily

// highlight-next-line
@ErrorFamily
enum class UserInfoErrorCode {
    ILLEGAL_USER_NAME,
    PASSWORD_TOO_SHORT,
    PASSWORDS_NOT_SAME
}
```

</TabItem>
</Tabs>

The `@org.babyfish.jimmer.error.ErrorFamily` annotation indicates that this enum represents a family of business exceptions, and the enum itself serves as the error code for this family. 

The `@ErrorFamily` annotation will be processed by Jimmer's precompiler

:::info
Here, the precompiler refers to Annotation Processor for Java, and KSP for Kotlin.

This part of the code has been discussed in [Overview/Get Started/Generate Code](../../overview/get-started/generate-code), so it won't be repeated here.
:::

The precompiler will generate the following exception class based on this enum:

:::info
For enums used to declare exception families, you can choose to use `ErrorCode` or `Error` as a special suffix. 

- If there is such a special suffix, the exception class name = enum name without the suffix + `Exception`

- Otherwise, exception class name = enum name + `Exception`

So here the generated exception name is `UserInfoException` 
:::

After compilation by Jimmer, the following exception class will be generated.

<Tabs groupId="language">
<TabItem value="java" label="Java">

```java title="UserInfoException.java"
public abstract class UserInfoException
    extends CodeBasedException { ❶

    private UserInfoException(String message, Throwable cause) {
        super(message, cause);
    }

    @Override
    public abstract UserInfoErrorCode getCode(); ❷

    public static UserInfoException illegalUserName(@NotNull String message) { ❸
        return new IllegalUserName(
            message,
            null
        );
    }

    public static UserInfoException illegalUserName( ❹
            @NotNull String message,
            @Nullable Throwable cause
    ) {
        return new IllegalUserName(
            message,
            cause
        );
    }

    public static UserInfoException passwordTooShort(@NotNull String message) { ❺
        return new PasswordTooShort(
            message,
            null
        );
    }

    public static UserInfoException passwordTooShort( ❻
            @NotNull String message,
            @Nullable Throwable cause
    ) {
        return new PasswordTooShort(
            message,
            cause
        );
    }

    public static UserInfoException passwordsNotSame(@NotNull String message) { ❼
        return new PasswordsNotSame(
            message,
            null
        );
    }

    public static UserInfoException passwordsNotSame( ❽
            @NotNull String message,
            @Nullable Throwable cause
    ) {
        return new PasswordsNotSame(
            message,
            cause
        );
    }

    public static class IllegalUserName extends UserInfoException {
        public IllegalUserName(String message, Throwable cause) {
            super(message, cause);
        }

        @Override
        public UserInfoErrorCode getCode() {
            return UserInfoErrorCode.ILLEGAL_USER_NAME; ❾
        }

        @Override
        public Map<String, Object> getFields() {
            return Collections.emptyMap();
        }
    }

    public static class PasswordTooShort extends UserInfoException {
        public PasswordTooShort(String message, Throwable cause) {
            super(message, cause);
        }

        @Override
        public UserInfoErrorCode getCode() {
            return UserInfoErrorCode.PASSWORD_TOO_SHORT; ❿
        }

        @Override
        public Map<String, Object> getFields() {
            return Collections.emptyMap();
        }
    }

    public static class PasswordsNotSame extends UserInfoException {
        public PasswordsNotSame(String message, Throwable cause) {
            super(message, cause);
        }

        @Override
        public UserInfoErrorCode getCode() {
            return UserInfoErrorCode.PASSWORDS_NOT_SAME; ⓫
        }

        @Override
        public Map<String, Object> getFields() {
            return Collections.emptyMap();
        }
    }
}
```

</TabItem>
<TabItem value="kotlin" label="Kotlin">

```kotlin title="UserInfoException.kt"
public abstract class UserInfoException private constructor(
    message: String,
    cause: Throwable? = null,
) : CodeBasedException(message, cause) { ❶

    public abstract override val code: UserInfoErrorCode ❷

    public companion object {
        @JvmStatic
        public fun illegalUserName( ❸❹
            message: String, 
            cause: Throwable? = null
        ): UserInfoException =
            IllegalUserName(
                message,
                cause
            )

        @JvmStatic
        public fun passwordTooShort( ❺❻
            message: String, 
            cause: Throwable? = null
        ): UserInfoException =
            PasswordTooShort(
                message,
                cause
            )

        @JvmStatic
        public fun passwordsNotSame( ❼❽
            message: String, 
            cause: Throwable? = null
            ): UserInfoException =
                PasswordsNotSame(
                    message,
                    cause
                )
    }

    public class IllegalUserName(
        message: String,
        cause: Throwable? = null,
    ) : UserInfoException(message, cause) {

        public override val code: UserInfoErrorCode
            get() = UserInfoErrorCode.ILLEGAL_USER_NAME ❾

        public override val fields: Map<String, Any?>
            get() = emptyMap()
    }

    public class PasswordTooShort(
        message: String,
        cause: Throwable? = null,
    ) : UserInfoException(message, cause) {

        public override val code: UserInfoErrorCode
            get() = UserInfoErrorCode.PASSWORD_TOO_SHORT ❿

        public override val fields: Map<String, Any?>
            get() = emptyMap()
    }

    public class PasswordsNotSame(
        message: String,
        cause: Throwable? = null,
    ) : UserInfoException(message, cause) {

        public override val code: UserInfoErrorCode
            get() = UserInfoErrorCode.PASSWORDS_NOT_SAME ⓫

        public override val fields: Map<String, Any?>
            get() = emptyMap()
    }
}
```

</TabItem>
</Tabs>

- ❶ Exceptions based on enum error codes must inherit from `org.babyfish.jimmer.error.CodeBasedException`

- ❷ The error code type for this family of exceptions is `UserInfoErrorCode` 

- ❸❹ Static method to construct exception with error code `ILLEGAL_USER_NAME`

- ❺❻ Static method to construct exception with error code `PASSWORD_TOO_SHORT` 

- ❼❽ Static method to construct exception with error code `PASSWORDS_NOT_SAME`

- ❾ Exception class `UserInfoException.IllegalUserName` has error code `ILLEGAL_USER_NAME`

- ❿ Exception class `UserInfoException.PasswordTooShort` has error code `PASSWORD_TOO_SHORT`  

- ⓫ Exception class `UserInfoException.PasswordsNotSame` has error code `PASSWORDS_NOT_SAME`

### Add Fields to Error Codes

Additional fields can be added to any error code. 

For example, `ILLEGAL_USER_NAME` indicates an illegal username, i.e. the username contains illegal characters. We can add the field `illegalChars` for it.

<Tabs groupId="language">
<TabItem value="java" label="Java">  

```java title="UserInfoErrorCode.java"
@ErrorFamily
public enum UserInfoErrorCode {

    // highlight-next-line  
    @ErrorField(name = "illegalChars", type = Character.class, list = true)
    ILLEGAL_USER_NAME,
    
    PASSWORD_TOO_SHORT,

    PASSWORDS_NOT_SAME
}
```

</TabItem>
<TabItem value="kotlin" label="Kotlin">

```kotlin title="UserInfoErrorCode.kt"
@ErrorFamily  
enum class UserInfoErrorCode {
    
    // highlight-next-line
    @ErrorField(name = "illegalChars", type = Char::class, list = true) 
    ILLEGAL_USER_NAME,

    PASSWORD_TOO_SHORT,
    
    PASSWORDS_NOT_SAME
}
```

</TabItem>
</Tabs>

The generated code is as follows:

<Tabs groupId="language">
<TabItem value="java" label="Java">

```java title="UserInfoException.java"
public abstract class UserInfoException extends CodeBasedException {

    public static UserInfoException illegalUserName(
        @NotNull String message,
        // highlight-next-line
        @NotNull List<Character> illegalChars
    ) {
        ...omit code...
    }

    public static UserInfoException illegalUserName(
        @NotNull String message,
        @Nullable Throwable cause, 
        // highlight-next-line
        @NotNull List<Character> illegalChars
    ) {
        ...omit code...
    }

    public static class IllegalUserName extends UserInfoException {

        @NotNull
        private final List<Character> illegalChars;

        public IllegalUserName(
            String message, 
            Throwable cause,
            // highlight-next-line
            @NotNull List<Character> illegalChars
        ) {
            super(message, cause);
            this.illegalChars = illegalChars;
        }

        @Override
        public Map<String, Object> getFields() {
            // highlight-next-line
            return Collections.singletonMap("illegalChars", illegalChars);
        }

        @NotNull
        public List<Character> getIllegalChars() {
            // highlight-next-line
            return illegalChars;
        }

        ...omit other code...
    }

    ...omit other code...
}
```

</TabItem>
<TabItem value="kotlin" label="Kotlin">

```kotlin title="UserInfoException.kt"
public abstract class UserInfoException private constructor(
    message: String,
    cause: Throwable? = null,
) : CodeBasedException(message, cause) { ❶

    public abstract override val code: UserInfoErrorCode ❷

    public companion object {
        
        @JvmStatic
        public fun illegalUserName(
            message: String,
            cause: Throwable? = null,
            // highlight-next-line
            illegalChars: List<Char>,
        ): UserInfoException = 
            ...omit code...

        ...omit other code...
    }

    public class IllegalUserName(
        message: String,
        cause: Throwable? = null,
        // highlight-next-line
        public val illegalChars: List<Char>,
    ) : UserInfoException(message, cause) {

        public override val fields: Map<String, Any?>
            get() = mapOf(
                // highlight-next-line
                "illegalChars" to illegalChars
            )

        ...omit other code...
    }
}
```

</TabItem>
</Tabs>

## Declare Exceptions for REST APIs  

### Allow To Throw All Exceptions Of Family

<Tabs groupId="language">
<TabItem value="java" label="Java">

```java title="UserController.java"
package com.example.service;

import org.babyfish.jimmer.client.ThrowsAll;

@PostMapping("/user")
// highlight-next-line
@ThrowsAll(UserInfoErrorCode.class) 
public void registerUser(@RequestBody RegisterUserInput input) {
    ...omit code...
}
```

</TabItem>
<TabItem value="kotlin" label="Kotlin">

```kotlin title="UserController.kt" 
package com.example.service

import import org.babyfish.jimmer.client.ThrowsAll

@PostMapping("/user")
// highlight-next-line
@ThrowsAll(UserInfoErrorCode::class)
fun registerUser(@RequestBody input: RegisterUserInput) {
    ...omit code...
}
```

</TabItem>
</Tabs>

:::info
The `@org.babyfish.jimmer.client.ThrowsAll` annotation allows the REST API to throw all exceptions in the family.
:::

### Allow To Throw Some Exceptions Of Family

Let's locate another business exception family:

<Tabs groupId="language">
<TabItem value="java" label="Java">

```java title="PlatformErrorCode.java"
@ErrorFamily
public enum PlatformErrorCode {
    PERMISSION_DENIED,
    DATA_IS_FROZEN,
    SERVICE_IS_SUSPENDED,
}
```

</TabItem>
<TabItem value="kotlin" label="Kotlin">

```kotlin title="PlatformErrorCode.kt"
@ErrorFamily
enum class PlatformErrorCode {
    PERMISSION_DENIED,
    DATA_IS_FROZEN,
    SERVICE_IS_SUSPENDED
} 
```

</TabItem>  
</Tabs>

To be able to declare that a REST API can only throw some of the exceptions in this family, define the following annotation:

<Tabs groupId="language">
<TabItem value="java" label="Java">  

```java title="ThrowsPlatformError.java"
@Documented
@Retention(RetentionPolicy.RUNTIME)  
@Target(ElementType.METHOD)
public @interface ThrowsPlatformError {
    PlatformErrorCode[] value();
}
```

</TabItem>
<TabItem value="kotlin" label="Kotlin">

```kotlin title="ThrowsPlatformError.kt"
@Retention(AnnotationRetention.RUNTIME)
@Target(AnnotationTarget.FUNCTION)  
annotation class ThrowsPlatformError(
    val value: Array<PlatformErrorCode>
)
```

</TabItem>
</Tabs>

This annotation satisfies the following 5 conditions:

- `Retention` is configured as `RUNTIME`, i.e. reflectable at runtime

- `Target` is configured as `METHOD` or `FUNCTION` *(kotlin)*, can be used to decorate methods

- Has a property named `value` 

- The `value` property is of array type  

- The array element type of `value` is an enum decorated with `@ErrorFamily`.

:::tip
If an annotation satisfies all the above conditions, it can be used to decorate REST APIs to declare the exceptions that can be thrown. Just like how we use `@ThrowsAll`.
:::

<Tabs groupId="language"> 
<TabItem value="java" label="Java">

```java title="UserController.java"  
@PostMapping("/user")
@ThrowsAll(UserInfoErrorCode.class)
// highlight-next-line
@ThrowsPlatformError({PlatformErrorCode.SERVICE_IS_SUSPENDED})
public void registerUser(@RequestBody RegisterUserInput input) {
    ...omit code...
}
```

</TabItem>
<TabItem value="kotlin" label="Kotlin">

```kotlin title="UserController.kt"
@PostMapping("/user")
@ThrowsAll(UserInfoErrorCode::class) 
// highlight-next-line
@ThrowsPlatformError([PlatformErrorCode.SERVICE_IS_SUSPENDED])  
fun registerUser(@RequestBody input: RegisterUserInput) {
    ...omit code...
}
```

</TabItem>
</Tabs>

## Export Server Side Exceptions  

### Throw Exceptions

<Tabs groupId="language">
<TabItem value="java" label="Java">

```java title="UserController.java"  
@PostMapping("/user")
@ThrowsAll(UserInfoErrorCode.class)
@ThrowsPlatformError({PlatformErrorCode.SERVICE_IS_SUSPENDED})
public void registerUser(@RequestBody RegisterUserInput input) {
    if (...some condition...) {
        // highlight-next-line
        throw PlatformException.serviceIsSuspended(
            "The service is suspended"
        );
    }
    ...omit other code...
}
```

</TabItem>
<TabItem value="kotlin" label="Kotlin">

```kotlin title="UserController.kt"
@PostMapping("/user")
@ThrowsAll(UserInfoErrorCode::class)
@ThrowsPlatformError([PlatformErrorCode.SERVICE_IS_SUSPENDED])
fun registerUser(@RequestBody input: RegisterUserInput) {
    if (...some condition...) {
        // highlight-next-line
        throw PlatformException.serviceIsSuspended(
            "The service is suspended"
        )
    }
    ...omit other code...
}
```

</TabItem>
</Tabs>

:::caution
The kinds of exceptions thrown internally must not exceed those declared externally.
:::

### Write Exception Messages to HTTP Responses

:::tip
As long as Jimmer's Spring Boot Starter is used, no extra work is required. Any exception inherited from `CodeBasedException` thrown by the service will be automatically translated.
:::

The translation result is:

```json
{
    "family":"USER_INFO_ERROR_CODE",
    "code":"ILLEGAL_USER_NAME",
    "illegalChars": ["&", "`", "@"]
}
```

To facilitate development and testing, you can configure in `application.yml` or `application.properties`:
```
jimmer:
    error-translator:
        debug-info-supported: true
```

This configuration will include information useful for locating issues during development and testing in the HTTP response. Since the content is quite long, please click the button below to view the result.

<ViewMore buttonText="View Result" title="Exception Return with Debug Info">

```json
{
    "family":"USER_INFO_ERROR_CODE",
    "code":"ILLEGAL_USER_NAME",
    "illegalChars": ["&", "`", "@"],
    // highlight-next-line
    "debugInfo":{
        "message":"Illegal user name, it contains some illegal chars",
        "stackFrames":[
            "org.babyfish.jimmer.spring.java.bll.ErrorService.test(ErrorService.java:18)",
            "java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)",
            "java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:78)",
            "java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)",
            "java.base/java.lang.reflect.Method.invoke(Method.java:567)",
            "org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:205)",
            "org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:150)",
            "org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:117)",
            "org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:895)",
            "org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:808)",
            "org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)",
            "org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1067)",
            "org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:963)",
            "org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1006)",
            "org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:898)",
            "javax.servlet.http.HttpServlet.service(HttpServlet.java:655)",
            "org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:883)",
            "org.springframework.test.web.servlet.TestDispatcherServlet.service(TestDispatcherServlet.java:72)",
            "javax.servlet.http.HttpServlet.service(HttpServlet.java:764)",
            "org.springframework.mock.web.MockFilterChain$ServletFilterProxy.doFilter(MockFilterChain.java:167)",
            "org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:134)",
            "org.springframework.test.web.servlet.MockMvc.perform(MockMvc.java:199)",
            "org.babyfish.jimmer.spring.java.SpringJavaTest.testError(SpringJavaTest.java:632)",
            "java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)",
            "java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:78)",
            "java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)",
            "java.base/java.lang.reflect.Method.invoke(Method.java:567)",
            "org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:725)",
            "org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)",
            "org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131)",
            "org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:149)",
            "org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestableMethod(TimeoutExtension.java:140)",
            "org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestMethod(TimeoutExtension.java:84)",
            "org.junit.jupiter.engine.execution.ExecutableInvoker$ReflectiveInterceptorCall.lambda$ofVoidMethod$0(ExecutableInvoker.java:115)",
            "org.junit.jupiter.engine.execution.ExecutableInvoker.lambda$invoke$0(ExecutableInvoker.java:105)",
            "org.junit.jupiter.engine.execution.InvocationInterceptorChain$InterceptedInvocation.proceed(InvocationInterceptorChain.java:106)",
            "org.junit.jupiter.engine.execution.InvocationInterceptorChain.proceed(InvocationInterceptorChain.java:64)",
            "org.junit.jupiter.engine.execution.InvocationInterceptorChain.chainAndInvoke(InvocationInterceptorChain.java:45)",
            "org.junit.jupiter.engine.execution.InvocationInterceptorChain.invoke(InvocationInterceptorChain.java:37)",
            "org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:104)",
            "org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:98)",
            "org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$invokeTestMethod$7(TestMethodTestDescriptor.java:214)",
            "org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)",
            "org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.invokeTestMethod(TestMethodTestDescriptor.java:210)",
            "org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:135)",
            "org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:66)",
            "org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:151)",
            "org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)",
            "org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)",
            "org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)",
            "org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)",
            "org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)",
            "org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)",
            "org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)",
            "java.base/java.util.ArrayList.forEach(ArrayList.java:1511)",
            "org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)",
            "org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)",
            "org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)",
            "org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)",
            "org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)",
            "org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)",
            "org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)",
            "org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)",
            "org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)",
            "java.base/java.util.ArrayList.forEach(ArrayList.java:1511)",
            "org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)",
            "org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)",
            "org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)",
            "org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)",
            "org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)",
            "org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)",
            "org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)",
            "org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)",
            "org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)",
            "org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:35)",
            "org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57)",
            "org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:54)",
            "org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:108)",
            "org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:88)",
            "org.junit.platform.launcher.core.EngineExecutionOrchestrator.lambda$execute$0(EngineExecutionOrchestrator.java:54)",
            "org.junit.platform.launcher.core.EngineExecutionOrchestrator.withInterceptedStreams(EngineExecutionOrchestrator.java:67)",
            "org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:52)",
            "org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:96)",
            "org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:75)",
            "org.gradle.api.internal.tasks.testing.junitplatform.JUnitPlatformTestClassProcessor$CollectAllTestClassesExecutor.processAllTestClasses(JUnitPlatformTestClassProcessor.java:99)",
            "org.gradle.api.internal.tasks.testing.junitplatform.JUnitPlatformTestClassProcessor$CollectAllTestClassesExecutor.access$000(JUnitPlatformTestClassProcessor.java:79)",
            "org.gradle.api.internal.tasks.testing.junitplatform.JUnitPlatformTestClassProcessor.stop(JUnitPlatformTestClassProcessor.java:75)",
            "org.gradle.api.internal.tasks.testing.SuiteTestClassProcessor.stop(SuiteTestClassProcessor.java:61)",
            "java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)",
            "java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:78)",
            "java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)",
            "java.base/java.lang.reflect.Method.invoke(Method.java:567)",
            "org.gradle.internal.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:36)",
            "org.gradle.internal.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:24)",
            "org.gradle.internal.dispatch.ContextClassLoaderDispatch.dispatch(ContextClassLoaderDispatch.java:33)",
            "org.gradle.internal.dispatch.ProxyDispatchAdapter$DispatchingInvocationHandler.invoke(ProxyDispatchAdapter.java:94)",
            "jdk.proxy1/jdk.proxy1.$Proxy2.stop(Unknown Source)",
            "org.gradle.api.internal.tasks.testing.worker.TestWorker.stop(TestWorker.java:135)",
            "java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)",
            "java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:78)",
            "java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)",
            "java.base/java.lang.reflect.Method.invoke(Method.java:567)",
            "org.gradle.internal.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:36)",
            "org.gradle.internal.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:24)",
            "org.gradle.internal.remote.internal.hub.MessageHubBackedObjectConnection$DispatchWrapper.dispatch(MessageHubBackedObjectConnection.java:182)",
            "org.gradle.internal.remote.internal.hub.MessageHubBackedObjectConnection$DispatchWrapper.dispatch(MessageHubBackedObjectConnection.java:164)",
            "org.gradle.internal.remote.internal.hub.MessageHub$Handler.run(MessageHub.java:414)",
            "org.gradle.internal.concurrent.ExecutorPolicy$CatchAndRecordFailures.onExecute(ExecutorPolicy.java:64)",
            "org.gradle.internal.concurrent.ManagedExecutorImpl$1.run(ManagedExecutorImpl.java:48)",
            "java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1130)",
            "java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:630)",
            "org.gradle.internal.concurrent.ThreadFactoryImpl$ManagedThreadRunnable.run(ThreadFactoryImpl.java:56)",
            "java.base/java.lang.Thread.run(Thread.java:831)"
        ],
        // highlight-next-line
        "causeBy":{
            "message":null,
            "stackFrames":[
                "org.babyfish.jimmer.spring.java.bll.ErrorService.registerUser(ErrorService.java:28)",
                "org.babyfish.jimmer.spring.java.bll.ErrorService.test(ErrorService.java:16)",
                "java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)",
                "java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:78)",
                "java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)",
                "java.base/java.lang.reflect.Method.invoke(Method.java:567)",
                "org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:205)",
                "org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:150)",
                "org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:117)",
                "org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:895)",
                "org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:808)",
                "org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)",
                "org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1067)",
                "org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:963)",
                "org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1006)",
                "org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:898)",
                "javax.servlet.http.HttpServlet.service(HttpServlet.java:655)",
                "org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:883)",
                "org.springframework.test.web.servlet.TestDispatcherServlet.service(TestDispatcherServlet.java:72)",
                "javax.servlet.http.HttpServlet.service(HttpServlet.java:764)",
                "org.springframework.mock.web.MockFilterChain$ServletFilterProxy.doFilter(MockFilterChain.java:167)",
                "org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:134)",
                "org.springframework.test.web.servlet.MockMvc.perform(MockMvc.java:199)",
                "org.babyfish.jimmer.spring.java.SpringJavaTest.testError(SpringJavaTest.java:632)",
                "java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)",
                "java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:78)",
                "java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)",
                "java.base/java.lang.reflect.Method.invoke(Method.java:567)",
                "org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:725)",
                "org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)",
                "org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131)",
                "org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:149)",
                "org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestableMethod(TimeoutExtension.java:140)",
                "org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestMethod(TimeoutExtension.java:84)",
                "org.junit.jupiter.engine.execution.ExecutableInvoker$ReflectiveInterceptorCall.lambda$ofVoidMethod$0(ExecutableInvoker.java:115)",
                "org.junit.jupiter.engine.execution.ExecutableInvoker.lambda$invoke$0(ExecutableInvoker.java:105)",
                "org.junit.jupiter.engine.execution.InvocationInterceptorChain$InterceptedInvocation.proceed(InvocationInterceptorChain.java:106)",
                "org.junit.jupiter.engine.execution.InvocationInterceptorChain.proceed(InvocationInterceptorChain.java:64)",
                "org.junit.jupiter.engine.execution.InvocationInterceptorChain.chainAndInvoke(InvocationInterceptorChain.java:45)",
                "org.junit.jupiter.engine.execution.InvocationInterceptorChain.invoke(InvocationInterceptorChain.java:37)",
                "org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:104)",
                "org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:98)",
                "org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$invokeTestMethod$7(TestMethodTestDescriptor.java:214)",
                "org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)",
                "org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.invokeTestMethod(TestMethodTestDescriptor.java:210)",
                "org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:135)",
                "org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:66)",
                "org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:151)",
                "org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)",
                "org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)",
                "org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)",
                "org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)",
                "org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)",
                "org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)",
                "org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)",
                "java.base/java.util.ArrayList.forEach(ArrayList.java:1511)",
                "org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)",
                "org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)",
                "org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)",
                "org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)",
                "org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)",
                "org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)",
                "org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)",
                "org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)",
                "org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)",
                "java.base/java.util.ArrayList.forEach(ArrayList.java:1511)",
                "org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)",
                "org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)",
                "org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)",
                "org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)",
                "org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)",
                "org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)",
                "org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)",
                "org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)",
                "org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)",
                "org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:35)",
                "org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57)",
                "org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:54)",
                "org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:108)",
                "org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:88)",
                "org.junit.platform.launcher.core.EngineExecutionOrchestrator.lambda$execute$0(EngineExecutionOrchestrator.java:54)",
                "org.junit.platform.launcher.core.EngineExecutionOrchestrator.withInterceptedStreams(EngineExecutionOrchestrator.java:67)",
                "org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:52)",
                "org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:96)",
                "org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:75)",
                "org.gradle.api.internal.tasks.testing.junitplatform.JUnitPlatformTestClassProcessor$CollectAllTestClassesExecutor.processAllTestClasses(JUnitPlatformTestClassProcessor.java:99)",
                "org.gradle.api.internal.tasks.testing.junitplatform.JUnitPlatformTestClassProcessor$CollectAllTestClassesExecutor.access$000(JUnitPlatformTestClassProcessor.java:79)",
                "org.gradle.api.internal.tasks.testing.junitplatform.JUnitPlatformTestClassProcessor.stop(JUnitPlatformTestClassProcessor.java:75)",
                "org.gradle.api.internal.tasks.testing.SuiteTestClassProcessor.stop(SuiteTestClassProcessor.java:61)",
                "java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)",
                "java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:78)",
                "java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)",
                "java.base/java.lang.reflect.Method.invoke(Method.java:567)",
                "org.gradle.internal.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:36)",
                "org.gradle.internal.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:24)",
                "org.gradle.internal.dispatch.ContextClassLoaderDispatch.dispatch(ContextClassLoaderDispatch.java:33)",
                "org.gradle.internal.dispatch.ProxyDispatchAdapter$DispatchingInvocationHandler.invoke(ProxyDispatchAdapter.java:94)",
                "jdk.proxy1/jdk.proxy1.$Proxy2.stop(Unknown Source)",
                "org.gradle.api.internal.tasks.testing.worker.TestWorker.stop(TestWorker.java:135)",
                "java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)",
                "java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:78)",
                "java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)",
                "java.base/java.lang.reflect.Method.invoke(Method.java:567)",
                "org.gradle.internal.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:36)",
                "org.gradle.internal.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:24)",
                "org.gradle.internal.remote.internal.hub.MessageHubBackedObjectConnection$DispatchWrapper.dispatch(MessageHubBackedObjectConnection.java:182)",
                "org.gradle.internal.remote.internal.hub.MessageHubBackedObjectConnection$DispatchWrapper.dispatch(MessageHubBackedObjectConnection.java:164)",
                "org.gradle.internal.remote.internal.hub.MessageHub$Handler.run(MessageHub.java:414)",
                "org.gradle.internal.concurrent.ExecutorPolicy$CatchAndRecordFailures.onExecute(ExecutorPolicy.java:64)",
                "org.gradle.internal.concurrent.ManagedExecutorImpl$1.run(ManagedExecutorImpl.java:48)",
                "java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1130)",
                "java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:630)",
                "org.gradle.internal.concurrent.ThreadFactoryImpl$ManagedThreadRunnable.run(ThreadFactoryImpl.java:56)",
                "java.base/java.lang.Thread.run(Thread.java:831)"
            ]
        }
    }
}
```

</ViewMore>  

:::warning
This configuration is only for assisting development and testing, and must NOT be enabled in production environments!

For example, enable this switch in `application-dev.yml` and `application-test.yml`, but absolutely do NOT enable it in `application-prod.yml`.
:::

## Client

### Generated TypeScript Code  

```ts
export type AllErrors = ❶
    {
        readonly family: "PLATFORM_ERROR_CODE", ❷
        readonly code: "SERVICE_IS_SUSPENDED" ❸
    } |
    {
        readonly family: "USER_INFO_ERROR_CODE",
        readonly code: "ILLEGAL_USER_NAME",
        readonly "illegalChars": ReadonlyArray<number> ❹
    } |
    {
        readonly family: "USER_INFO_ERROR_CODE",
        readonly code: "PASSWORDS_NOT_SAME"
    } |
    {
        readonly family: "USER_INFO_ERROR_CODE",
        readonly code: "PASSWORD_TOO_SHORT"
    } |
    ...omit other code...
;

export type ApiErrors = { ❺
    "userController": { ❻
        "registerUser": AllErrors & ( ❼
            {
                readonly family: 'USER_INFO_ERROR_CODE',
                readonly code: 'ILLEGAL_USER_NAME',
                readonly [key:string]: any
            } |
            {
                readonly family: 'USER_INFO_ERROR_CODE',
                readonly code: 'PASSWORD_TOO_SHORT',
                readonly [key:string]: any
            } |
            {
                readonly family: 'USER_INFO_ERROR_CODE',
                readonly code: 'PASSWORDS_NOT_SAME',
                readonly [key:string]: any
            } |
            {
                readonly family: 'PLATFORM_ERROR_CODE',
                readonly code: 'SERVICE_IS_SUSPENDED',
                readonly [key:string]: any
            }
        ),
        ...omit other code...
    },
    "bookController": {
        ...omit code...
    },
    ...omit other code...
};
```

-   ❶ `AllErrors` defines all error types

    :::caution  
    Only REST APIs that explicitly declare exceptions that may be thrown via annotations in Java/Kotlin code will be used to generate TypeScript code.
    
    For example, in the Java/Kotlin code above, we defined the error codes `PlatformError.PERMISSION_DENIED` and `PlatformErrorCode.DATA_IS_FROZEN`, but they have not yet been declared as throwable by any REST API using `@ThrowsAll` or custom `@ThrowsPlatformError`. So they will not be defined in `AllErrors`.
    :::

-   ❷ The enum name decorated with `@ErrorFamily` is the `family` field in client code, used to identify which family the error belongs to

-   ❸ The enum variable name is the `code` field in client code, used to identify which specific error it is

-   ❹ The server uses `@ErrorField` *(can repeat)* to declare arbitrary additional fields for an error code *(only one here)*, so all additional fields are generated here

    :::tip
    ❶ `AllErrors` defines all errors, never duplicated.
    
    `ApiErrors` at ❺ refers to errors, may have duplicates. Because different REST APIs may declare throwing the same error code.

    So additional fields are always declared in `AllErrors`, not in `ApiErrors`. This is the fundamental reason `AllErrors` and `ApiErrors` are separated.
    :::

-   ❺ Errors that each REST API may throw 

-   ❻ Errors that `userController` module may throw

-   ❼ Errors that `userController.registerUser` API may throw

### TypeScript IDE Effects

The above TypeScript code is quite lengthy, and considering some readers may not have TypeScript background knowledge, here are some IDE auto-complete screenshots:

-   Under global type `ApiErrors`, there are two options: `userController` and `bookController`

    <VsModule/>

-   `ApiErrors["userController"]` has three options: `login`, `logout` and `registerUser`

    <VsApi/>

-   For `ApiErrors["userController"]["registerUser"]`, the `family` field has two options: `USER_INFO_ERROR_CODE` and `PLATFORM_ERROR_CODE`

    <VsFamily/> 

-   Once `family` is determined as `UserInfoErrorCode`, the `code` field has three options: `ILLEGAL_USER_NAME`, `PASSWORD_TOO_SHORT` and `PASSWORDS_NOT_SAME`

    <VsCode/>

-   Once `code` is determined as `ILLEGAL_USER_NAME`, the additional `illegalChars` field can be used

    <VsField/>
